<?xml version="1.0" encoding="utf-8" ?>

<ContentPage
    x:Class="MauiApp9.OcrPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!--  Title  -->
            <Label
                FontAttributes="Bold"
                FontSize="24"
                HorizontalOptions="Center"
                Text="OCR" />

            <!--  Enhanced OCR Mode Switch  -->
            <HorizontalStackLayout HorizontalOptions="Center" Spacing="12">
                <Label
                    FontAttributes="Bold"
                    Text="Enhanced OCR Mode"
                    VerticalOptions="Center" />
                <Switch
                    IsToggled="False"
                    OnColor="DodgerBlue"
                    ThumbColor="White"
                    x:Name="TryHardSwitch" />
            </HorizontalStackLayout>

            <!--  Image Source Buttons  -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                <Button
                    BackgroundColor="DodgerBlue"
                    Clicked="CameraTabBtn_Clicked"
                    Grid.Column="0"
                    Text="Camera"
                    TextColor="White"
                    x:Name="CameraTabBtn" />

                <Button
                    BackgroundColor="Green"
                    Clicked="FileTabBtn_Clicked"
                    Grid.Column="1"
                    Text="File"
                    TextColor="White"
                    x:Name="FileTabBtn" />
            </Grid>

            <!--  Camera Options  -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10" x:Name="CameraOptions">
                <Button
                    BackgroundColor="DodgerBlue"
                    Clicked="OpenFromCameraBtn_Clicked"
                    Grid.Column="0"
                    Text="Take Photo"
                    TextColor="White"
                    x:Name="OpenFromCameraBtn" />
                <Button
                    BackgroundColor="DodgerBlue"
                    Clicked="OpenFromCameraUseEventBtn_Clicked"
                    Grid.Column="1"
                    Text="Take Photo (Event)"
                    TextColor="White"
                    x:Name="OpenFromCameraUseEventBtn" />
            </Grid>

            <!--  File Options  -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10" IsVisible="False" x:Name="FileOptions">
                <Button
                    BackgroundColor="Green"
                    Clicked="OpenFromFileBtn_Clicked"
                    Grid.Column="0"
                    Text="Pick Photo"
                    TextColor="White"
                    x:Name="OpenFromFileBtn" />
                <Button
                    BackgroundColor="Green"
                    Clicked="OpenFromFileUseEventBtn_Clicked"
                    Grid.Column="1"
                    Text="Pick Photo (Event)"
                    TextColor="White"
                    x:Name="OpenFromFileUseEventBtn" />
            </Grid>

            <!--  Selected Image Display  -->
            <Border
                BackgroundColor="LightGray"
                MinimumHeightRequest="200"
                Stroke="Gray"
                StrokeThickness="2">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow
                        Brush="Black"
                        Offset="2,2"
                        Opacity="0.3"
                        Radius="5" />
                </Border.Shadow>
                <Grid>
                    <Image
                        Aspect="AspectFit"
                        BackgroundColor="White"
                        x:Name="CapturedImage" />

                    <!--  Placeholder when no image  -->
                    <VerticalStackLayout
                        HorizontalOptions="Center"
                        IsVisible="True"
                        VerticalOptions="Center"
                        x:Name="NoImagePlaceholder">
                        <Label
                            FontSize="48"
                            HorizontalOptions="Center"
                            Text="ðŸ“·"
                            TextColor="#BDBDBD" />
                        <Label
                            HorizontalOptions="Center"
                            Margin="0,8,0,0"
                            Text="No image selected"
                            TextColor="#757575" />
                    </VerticalStackLayout>
                </Grid>
            </Border>

            <!--  Process Buttons  -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                <Button
                    BackgroundColor="Orange"
                    Clicked="EnhanceImageBtn_Clicked"
                    Grid.Column="0"
                    IsEnabled="{Binding Source={x:Reference CapturedImage}, Path=Source, Converter={toolkit:IsNotNullConverter}}"
                    Text="Use OpenCV"
                    TextColor="White"
                    x:Name="EnhanceImageBtn" />
                <Button
                    BackgroundColor="Red"
                    Clicked="ClearBtn_Clicked"
                    Grid.Column="1"
                    IsEnabled="{Binding Source={x:Reference CapturedImage}, Path=Source, Converter={toolkit:IsNotNullConverter}}"
                    Text="Clear All"
                    TextColor="White"
                    x:Name="ClearBtn" />
            </Grid>

            <!--  Loading Indicator  -->
            <ActivityIndicator
                Color="Blue"
                IsRunning="False"
                IsVisible="False"
                x:Name="LoadingIndicator" />

            <!--  OCR Result Text Area  -->
            <Label
                FontAttributes="Bold"
                FontSize="16"
                Text="OCR Result:" />

            <Border
                BackgroundColor="White"
                MinimumHeightRequest="150"
                Stroke="Gray"
                StrokeThickness="2">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="5" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow
                        Brush="Black"
                        Offset="2,2"
                        Opacity="0.3"
                        Radius="5" />
                </Border.Shadow>
                <Grid>
                    <ScrollView>
                        <Label
                            FontSize="14"
                            Padding="10"
                            Text="Waiting for results ..."
                            TextColor="Black"
                            VerticalOptions="StartAndExpand"
                            x:Name="ResultLbl" />
                    </ScrollView>
                    
                    <!--  Copy Button  -->
                    <Button
                        BackgroundColor="Transparent"
                        Clicked="CopyBtn_Clicked"
                        HorizontalOptions="End"
                        IsVisible="{Binding Source={x:Reference ResultLbl}, Path=Text, Converter={toolkit:IsNotEqualConverter}, ConverterParameter='Waiting for results ...'}"
                        Text="ðŸ“‹"
                        VerticalOptions="Start"
                        x:Name="CopyBtn" />
                </Grid>
            </Border>

            <!--  AI Analysis Button  -->
            <Button
                BackgroundColor="DarkBlue"
                Clicked="AnalyzeWithAiBtn_Clicked"
                IsEnabled="{Binding Source={x:Reference ResultLbl}, Path=Text, Converter={toolkit:IsNotEqualConverter}, ConverterParameter='Waiting for results ...'}"
                Text="Analyze with AI"
                TextColor="White"
                x:Name="AnalyzeWithAiBtn" />

            <!--  AI Response Text Area  -->
            <Label
                FontAttributes="Bold"
                FontSize="16"
                Text="AI Response:" />

            <Border
                BackgroundColor="White"
                MinimumHeightRequest="150"
                Stroke="Blue"
                StrokeThickness="2">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="5" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow
                        Brush="Black"
                        Offset="2,2"
                        Opacity="0.3"
                        Radius="5" />
                </Border.Shadow>
                <ScrollView>
                    <Label
                        FontSize="14"
                        Padding="10"
                        Text="AI response will appear here..."
                        TextColor="Black"
                        VerticalOptions="StartAndExpand"
                        x:Name="AiResponseLbl" />
                </ScrollView>
            </Border>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>